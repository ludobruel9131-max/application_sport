<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Application Sport</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React, ReactDOM, and Babel for JSX transformation -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- React Router DOM -->
    <script src="https://unpkg.com/react-router-dom@6/dist/umd/react-router-dom.production.min.js"></script>
    <!-- React Toastify -->
    <script src="https://cdn.jsdelivr.net/npm/react-toastify@9.0.8/dist/react-toastify.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/react-toastify@9.0.8/dist/ReactToastify.min.css"/>
    <!-- Lucide React Icons -->
    <script type="module">
        import { createReactComponent } from 'https://unpkg.com/lucide-react@0.292.0/dist/lucide-react.js';
        window.lucide = { createReactComponent };
    </script>
    <!-- Firebase -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
      import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
      import { getFirestore } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
      window.firebase = { initializeApp, getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, getFirestore };
    </script>
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
      body {
        font-family: 'Inter', sans-serif;
      }
      .ReactToastify__toast-container {
        font-family: 'Inter', sans-serif;
      }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 antialiased">
    <div id="root" class="min-h-screen"></div>

    <script type="text/babel">
        const { useState, useEffect, createContext } = React;
        const { BrowserRouter, Routes, Route, Link, useLocation } = ReactRouterDOM;
        const { ToastContainer, toast } = window.ReactToastify;

        // Simplified UI components for this self-contained app
        const Card = ({ children, className }) => <div className={`p-6 rounded-2xl shadow-lg ${className}`}>{children}</div>;
        const CardHeader = ({ children }) => <div className="mb-4">{children}</div>;
        const CardTitle = ({ children }) => <h2 className="text-xl font-bold text-teal-400">{children}</h2>;
        const CardContent = ({ children }) => <div>{children}</div>;
        const Button = ({ children, className, ...props }) => (
            <button className={`py-2 px-4 rounded-lg font-semibold transition-colors ${className}`} {...props}>
                {children}
            </button>
        );

        // Utility to create Lucide icons
        const createIcon = (name) => {
            const Component = window.lucide.createReactComponent(name);
            return (props) => <Component {...props} />;
        };

        const LayoutDashboard = createIcon('LayoutDashboard');
        const Dumbbell = createIcon('Dumbbell');
        const HeartHandshake = createIcon('HeartHandshake');
        const Settings = createIcon('Settings');

        // Les données de l'application
        const fixedWorkoutData = [
          {
            week: 1,
            workouts: [
              {
                name: "Entraînement 1",
                exercises: [
                  { name: "Squat", sets: 3, reps: 10, weight: "60kg" },
                  { name: "Développé couché", sets: 3, reps: 8, weight: "40kg" },
                  { name: "Tirage vertical", sets: 3, reps: 12, weight: "30kg" },
                ],
              },
              {
                name: "Entraînement 2",
                exercises: [
                  { name: "Soulevé de terre", sets: 3, reps: 5, weight: "80kg" },
                  { name: "Presse à épaules", sets: 3, reps: 10, weight: "20kg" },
                  { name: "Rowing barre", sets: 3, reps: 10, weight: "40kg" },
                ],
              },
              {
                name: "Entraînement 3",
                exercises: [
                  { name: "Fentes", sets: 3, reps: 12, weight: "20kg" },
                  { name: "Dips", sets: 3, reps: 8, weight: "Poids de corps" },
                  { name: "Tirage horizontal", sets: 3, reps: 12, weight: "35kg" },
                ],
              },
            ],
          },
        ];

        const defaultProfile = {
          name: "Utilisateur",
          level: "Débutant",
          goals: "Force et endurance",
          lastWorkout: "Aucun",
          customWorkouts: [],
        };

        const getNewWorkoutLayout = (dataToUse, restDays) => {
          if (!dataToUse) return null;
          const daysOfWeek = ["Dimanche", "Lundi", "Mardi", "Mercredi", "Jeudi", "Vendredi", "Samedi"];
          const newWorkoutData = JSON.parse(JSON.stringify(dataToUse));
          newWorkoutData.forEach(week => {
            const workoutsToAssign = week.workouts.filter(w => w.exercises.length > 0);
            const newWorkouts = [];
            let workoutIndex = 0;
            for (let i = 0; i < 7; i++) {
              if (restDays.includes(i)) {
                newWorkouts.push({ day: daysOfWeek[i], exercises: [] });
              } else {
                if (workoutIndex < workoutsToAssign.length) {
                  newWorkouts.push({ ...workoutsToAssign[workoutIndex], day: daysOfWeek[i] });
                  workoutIndex++;
                } else {
                  newWorkouts.push({ day: daysOfWeek[i], exercises: [] });
                }
              }
            }
            week.workouts = newWorkouts;
          });
          return newWorkoutData;
        };

        const AppContext = createContext();

        const Shell = () => {
            const location = useLocation();
            const isDashboard = location.pathname === '/';
            const isWorkouts = location.pathname === '/workouts';
            const isLibrary = location.pathname === '/library';
            const isSettings = location.pathname === '/settings';

            return (
                <div className="flex flex-col min-h-screen bg-gray-900 text-gray-100">
                    <header className="p-4 bg-gray-800 shadow-md">
                        <div className="container mx-auto flex justify-between items-center">
                            <h1 className="text-2xl font-bold text-teal-400">Application Sport</h1>
                        </div>
                    </header>
                    <main className="flex-grow p-4">
                        <div className="container mx-auto">
                            <Routes>
                                <Route path="/" element={<Dashboard />} />
                                <Route path="/workouts" element={<Workouts />} />
                                <Route path="/library" element={<Library />} />
                                <Route path="/custom/:id" element={<CustomWorkout />} />
                                <Route path="/create-custom" element={<CreateCustomWorkout />} />
                                <Route path="/my-custom-workouts" element={<MyCustomWorkouts />} />
                                <Route path="/settings" element={<SettingsPage />} />
                                <Route path="/active-session" element={<ActiveSession />} />
                            </Routes>
                        </div>
                    </main>
                    <nav className="fixed bottom-0 left-0 right-0 bg-gray-800 shadow-lg border-t border-gray-700">
                        <ul className="flex justify-around items-center p-2">
                            <li>
                                <Link to="/" className={`flex flex-col items-center p-2 ${isDashboard ? 'text-teal-400' : 'text-gray-400'}`}>
                                    <LayoutDashboard size={24} />
                                    <span className="text-xs">Tableau de bord</span>
                                </Link>
                            </li>
                            <li>
                                <Link to="/workouts" className={`flex flex-col items-center p-2 ${isWorkouts ? 'text-teal-400' : 'text-gray-400'}`}>
                                    <Dumbbell size={24} />
                                    <span className="text-xs">Entraînements</span>
                                </Link>
                            </li>
                            <li>
                                <Link to="/library" className={`flex flex-col items-center p-2 ${isLibrary ? 'text-teal-400' : 'text-gray-400'}`}>
                                    <HeartHandshake size={24} />
                                    <span className="text-xs">Partenaires</span>
                                </Link>
                            </li>
                            <li>
                                <Link to="/settings" className={`flex flex-col items-center p-2 ${isSettings ? 'text-teal-400' : 'text-gray-400'}`}>
                                    <Settings size={24} />
                                    <span className="text-xs">Réglages</span>
                                </Link>
                            </li>
                        </ul>
                    </nav>
                </div>
            );
        };

        const Dashboard = () => {
          return (
            <div className="flex flex-col items-center justify-center p-6 bg-gray-900 text-gray-100 min-h-screen">
              <Card className="w-full max-w-2xl bg-gray-800 text-gray-100 border-gray-700 rounded-2xl shadow-lg">
                <CardHeader>
                  <CardTitle>Tableau de bord</CardTitle>
                </CardHeader>
                <CardContent>
                  <p>Ceci est votre tableau de bord. Il sera construit dans une prochaine étape.</p>
                </CardContent>
              </Card>
            </div>
          );
        };

        const Workouts = () => {
            return (
                <div className="flex flex-col items-center justify-center p-6 bg-gray-900 text-gray-100 min-h-screen">
                    <Card className="w-full max-w-2xl bg-gray-800 text-gray-100 border-gray-700 rounded-2xl shadow-lg">
                        <CardHeader>
                            <CardTitle>Entraînements</CardTitle>
                        </CardHeader>
                        <CardContent>
                            <p>Ceci est la page des entraînements. Elle sera construite dans une prochaine étape.</p>
                        </CardContent>
                    </Card>
                </div>
            );
        };

        const Library = () => {
            return (
                <div className="flex flex-col items-center justify-center p-6 bg-gray-900 text-gray-100 min-h-screen">
                    <Card className="w-full max-w-2xl bg-gray-800 text-gray-100 border-gray-700 rounded-2xl shadow-lg">
                        <CardHeader>
                            <CardTitle>Partenaires</CardTitle>
                        </CardHeader>
                        <CardContent>
                            <p>Ceci est la page des partenaires. Elle sera construite dans une prochaine étape.</p>
                        </CardContent>
                    </Card>
                </div>
            );
        };

        const CustomWorkout = () => {
            return (
                <div className="flex flex-col items-center justify-center p-6 bg-gray-900 text-gray-100 min-h-screen">
                    <Card className="w-full max-w-2xl bg-gray-800 text-gray-100 border-gray-700 rounded-2xl shadow-lg">
                        <CardHeader>
                            <CardTitle>Entraînement personnalisé</CardTitle>
                        </CardHeader>
                        <CardContent>
                            <p>Ceci est la page de l'entraînement personnalisé. Elle sera construite dans une prochaine étape.</p>
                        </CardContent>
                    </Card>
                </div>
            );
        };

        const CreateCustomWorkout = () => {
            return (
                <div className="flex flex-col items-center justify-center p-6 bg-gray-900 text-gray-100 min-h-screen">
                    <Card className="w-full max-w-2xl bg-gray-800 text-gray-100 border-gray-700 rounded-2xl shadow-lg">
                        <CardHeader>
                            <CardTitle>Créer un entraînement personnalisé</CardTitle>
                        </CardHeader>
                        <CardContent>
                            <p>Ceci est la page pour créer un entraînement personnalisé. Elle sera construite dans une prochaine étape.</p>
                        </CardContent>
                    </Card>
                </div>
            );
        };

        const MyCustomWorkouts = () => {
            return (
                <div className="flex flex-col items-center justify-center p-6 bg-gray-900 text-gray-100 min-h-screen">
                    <Card className="w-full max-w-2xl bg-gray-800 text-gray-100 border-gray-700 rounded-2xl shadow-lg">
                        <CardHeader>
                            <CardTitle>Mes entraînements personnalisés</CardTitle>
                        </CardHeader>
                        <CardContent>
                            <p>Ceci est la page de mes entraînements personnalisés. Elle sera construite dans une prochaine étape.</p>
                        </CardContent>
                    </Card>
                </div>
            );
        };

        const SettingsPage = () => {
            return (
                <div className="flex flex-col items-center justify-center p-6 bg-gray-900 text-gray-100 min-h-screen">
                    <Card className="w-full max-w-2xl bg-gray-800 text-gray-100 border-gray-700 rounded-2xl shadow-lg">
                        <CardHeader>
                            <CardTitle>Paramètres</Card-Title>
                        </CardHeader>
                        <CardContent>
                            <p>Ceci est la page des paramètres. Elle sera construite dans une prochaine étape.</p>
                        </CardContent>
                    </Card>
                </div>
            );
        };

        const ActiveSession = () => {
            return (
                <div className="flex flex-col items-center justify-center p-6 bg-gray-900 text-gray-100 min-h-screen">
                    <Card className="w-full max-w-2xl bg-gray-800 text-gray-100 border-gray-700 rounded-2xl shadow-lg">
                        <CardHeader>
                            <CardTitle>Session active</CardTitle>
                        </CardHeader>
                        <CardContent>
                            <p>Ceci est la page de session active. Elle sera construite dans une prochaine étape.</p>
                        </CardContent>
                    </Card>
                </div>
            );
        };

        function App() {
            const [state, setState] = useState(() => {
                const saved = localStorage.getItem("app_state");
                return saved ? JSON.parse(saved) : defaultProfile;
            });

            const [db, setDb] = useState(null);
            const [auth, setAuth] = useState(null);
            const [isAuthReady, setIsAuthReady] = useState(false);
            const [userId, setUserId] = useState(null);

            const [workoutData, setWorkoutData] = useState(null);
            const [view, setView] = useState('list');
            const [restDays, setRestDays] = useState([0, 6]);

            useEffect(() => {
                const initialWorkoutLayout = getNewWorkoutLayout(fixedWorkoutData, restDays);
                setWorkoutData(initialWorkoutLayout);
            }, []);

            useEffect(() => {
                if (workoutData) {
                    setWorkoutData(getNewWorkoutLayout(fixedWorkoutData, restDays));
                }
            }, [restDays]);

            useEffect(() => {
              try {
                const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
                if (!firebaseConfig || Object.keys(firebaseConfig).length === 0) {
                  console.error("Firebase config is not defined.");
                  return;
                }

                const app = window.firebase.initializeApp(firebaseConfig);
                const firestoreDb = window.firebase.getFirestore(app);
                const firebaseAuth = window.firebase.getAuth(app);

                setDb(firestoreDb);
                setAuth(firebaseAuth);

                const unsubscribe = window.firebase.onAuthStateChanged(firebaseAuth, async (user) => {
                  if (user) {
                    setUserId(user.uid);
                    setIsAuthReady(true);
                  } else {
                    if (typeof __initial_auth_token !== 'undefined') {
                      await window.firebase.signInWithCustomToken(firebaseAuth, __initial_auth_token);
                    } else {
                      await window.firebase.signInAnonymously(firebaseAuth);
                    }
                  }
                });
                return () => unsubscribe();
              } catch (error) {
                console.error("Failed to initialize Firebase:", error);
              }
            }, []);

            useEffect(() => {
                localStorage.setItem("app_state", JSON.stringify(state));
            }, [state]);

            const handleToggleRestDay = (dayIndex) => {
                setRestDays(prevRestDays => {
                    const isRestDay = prevRestDays.includes(dayIndex);
                    const currentRestDayCount = prevRestDays.length;

                    if (isRestDay) {
                        if (currentRestDayCount > 4) {
                            toast.warn("Le programme est conçu pour 3 jours d'entraînement. Veuillez en sélectionner un pour le remplacer.");
                            return prevRestDays;
                        }
                        return prevRestDays.filter(day => day !== dayIndex);
                    } else {
                        if (currentRestDayCount < 4) {
                            return [...prevRestDays, dayIndex].sort((a, b) => a - b);
                        } else {
                            toast.warn("Vous ne pouvez pas ajouter plus de jours de repos. Le programme a 3 jours d'entraînement.");
                            return prevRestDays;
                        }
                    }
                });
            };

            const daysOfWeek = ["Dimanche", "Lundi", "Mardi", "Mercredi", "Jeudi", "Vendredi", "Samedi"];

            return (
                <AppContext.Provider value={{ state, setState, db, auth, userId, isAuthReady, workoutData }}>
                    <BrowserRouter>
                        <Shell />
                    </BrowserRouter>
                    <ToastContainer position="bottom-right" theme="dark" />
                </AppContext.Provider>
            );
        }

        ReactDOM.render(<App />, document.getElementById("root"));
    </script>
</body>
</html>
